"use strict";(self.webpackChunklj_frontend=self.webpackChunklj_frontend||[]).push([[38],{8038:function(e,n,s){s.r(n),s.d(n,{default:function(){return _}});var t=s(9439),i=s(1413),o=s(1632),r=s(9806),a=s(673),c=s(1975),l=s(2791),u=s(7224),d=s(9626),m=s(184);function h(e){var n=e.title,s=e.onClick,i=e.onDelete,a=e.active,c=void 0!==a&&a,u=(0,l.useState)(!1),d=(0,t.Z)(u,2),h=d[0],f=d[1];return(0,m.jsxs)("div",{role:"button",className:["chat-label",c&&"active"].join(" "),onClick:s,children:[n,(0,m.jsx)("span",{className:"delete",onClick:function(){f(!0),"function"===typeof i&&i((function(){f(!1)}))},children:h?(0,m.jsx)(r.G,{icon:o.IJ7,spin:!0}):(0,m.jsx)(r.G,{icon:o.$aW})})]})}var f=s(3433),p=s(3257);function v(e){var n=e.content;return(0,m.jsx)("div",{className:"message ai-message",children:n})}function x(e){var n=e.content;return(0,m.jsx)("div",{className:"message user-message",children:n})}var j=s(1233),g=s(138),b=s(9085),y=s(1933),w=s(9128),N=s(5987),Z=["size","className"];function C(e){var n=e.size,s=e.className,t=(0,N.Z)(e,Z),o="";return"sm"===n&&(o+="spinner-grow-sm"),(0,m.jsx)("span",(0,i.Z)((0,i.Z)({className:["spinner-grow",o,s].join(" ")},t),{},{role:"status","aria-hidden":"true"}))}function k(e){var n=e.content;return(0,m.jsxs)("div",{className:"message ai-message",children:[(0,m.jsx)(C,{size:"sm"})," ",n||" Thinking..."]})}var A=s(476),S=s(2576);function D(e){var n=e.uuid,s=(0,u.FO)().isDemo,a=(0,u.v$)("demo_sub"),c=(0,t.Z)(a,2),d=c[0],h=c[1],N=d(),Z=(0,y.useQueryClient)(),C=(0,g.ZP)(n),D=C.isLoading,P=C.isError,q=C.error,U=C.chat,z=(0,l.useState)([]),F=(0,t.Z)(z,2),G=F[0],Q=F[1],_=(0,l.useState)(""),O=(0,t.Z)(_,2),T=O[0],E=O[1],M=(0,l.useState)(!1),L=(0,t.Z)(M,2),I=L[0],Y=L[1],H=(0,l.useState)(!1),R=(0,t.Z)(H,2),$=R[0],B=R[1],W=(0,u.bg)(),J=(0,t.Z)(W,2),V=J[0],X=J[1];(0,l.useEffect)((function(){if(null!==U&&void 0!==U&&U.chat_history)try{var e=[];JSON.parse(null===U||void 0===U?void 0:U.chat_history).map((function(n,s){"ai"===n.type?e[s]=(0,m.jsx)(v,{content:n.content},s):e[s]=(0,m.jsx)(x,{content:n.content},s)})),Q(e)}catch(q){console.log("error parsing chat history")}else Q([(0,m.jsx)(v,{content:"Hi, How can I assist you today?"},Math.random())]);X()}),[D,U]),(0,l.useEffect)((function(){X()}),[]);var K=(0,l.useCallback)((function(e){return e.preventDefault(),T.trim()?s&&(null===N||void 0===N?void 0:N.questions)<=0?b.Am.warning("The demo quota is exceeded, please wait 12 hours \ud83d\ude4f"):(Y(!0),Q((function(e){return[].concat((0,f.Z)(e),[(0,m.jsx)(x,{content:T},Math.random()),(0,m.jsx)(k,{},Math.random())])})),E(""),X(),void(0,w.u3)(n,T).then((function(e){if(null!==e&&void 0!==e&&e.errors)b.Am.error(e.message),Q((function(e){return e.slice(0,-1)}));else{var n,t,o=null===e||void 0===e||null===(n=e.response)||void 0===n||null===(t=n.output)||void 0===t?void 0:t.trim();o||b.Am.error("OpenAI servers are overloaded, please try again or later"),Q((function(e){return[].concat((0,f.Z)(e.slice(0,-1)),[(0,m.jsx)(v,{content:o},Math.random())])})),Z.invalidateQueries("user.subscription"),s&&h((function(e){return(0,i.Z)((0,i.Z)({},e),{},{questions:e.questions-1})}))}})).catch((function(e){var n,s,t,i;null!==(n=e.response)&&void 0!==n&&null!==(s=n.data)&&void 0!==s&&s.message?b.Am.warning(null===(t=e.response)||void 0===t||null===(i=t.data)||void 0===i?void 0:i.message):b.Am.error(e.message);Q((function(e){return e.slice(0,-1)}))})).finally((function(){Y(!1),Z.invalidateQueries("user.chat.".concat(n)),X()}))):b.Am.warning("Please ask something.")}),[n,T]),ee=(0,l.useCallback)((function(e){(0,w.tY)(n).then((function(e){console.log("prompt stopped")})).catch((function(e){var n,s;422===e.response.status||400===e.response.status?b.Am.warning(null===(n=e.response)||void 0===n||null===(s=n.data)||void 0===s?void 0:s.message):b.Am.error(e.message)})).finally((function(){})),Y(!1),Q((function(e){return e.slice(0,-1)}))}),[n]),ne=(0,l.useCallback)((function(){B(!0),(0,w.zR)(n).then((function(e){204===e.status?(b.Am.success("Cleared successfully."),Q([])):b.Am.warning("Something went wrong!")})).catch((function(e){b.Am.error(e)})).finally((function(){B(!1)}))}),[n]);return D?(0,m.jsx)(j.Z,{center:!0}):(P&&b.Am.error(q),(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:"chats flex-grow-1 d-flex align-items-end",children:(0,m.jsx)("div",{className:"container px-4",children:G.map((function(e,n){return e}))})}),(0,m.jsxs)("div",{className:"container prompt-input d-flex gap-2 pt-5 pb-5 px-4",ref:V,children:[(0,m.jsxs)("form",{onSubmit:K,className:"flex-grow-1",children:[(0,m.jsx)("input",{type:"text",value:T,onChange:function(e){return E(e.target.value)},className:"form-control form-control-lg",placeholder:"Ask anything..."}),(0,m.jsxs)("small",{className:"mx-3",children:["Note: if the chat bot said that he doesn't have access to document or doesn't know where to look up, just tell him \"",(0,m.jsx)("b",{children:(0,m.jsx)("i",{children:"from document?"})}),'".']})]}),(0,m.jsx)(A.Z,{placement:"top",delay:{show:250,hide:400},overlay:function(e){return(0,m.jsx)(S.Z,(0,i.Z)((0,i.Z)({id:"button-tooltip"},e),{},{children:I?"Stop":"Send"}))},children:(0,m.jsx)(p.Z,{className:["btn btn-lg send",I?"btn-danger":"btn-primary"].join(" "),title:I?"Stop":"Send",onClick:function(e){if(I)return ee(e);K(e)},children:I?(0,m.jsx)(r.G,{icon:o.Bg$}):(0,m.jsx)(r.G,{icon:o.XCy})})}),(0,m.jsx)(A.Z,{placement:"top",delay:{show:250,hide:400},overlay:function(e){return(0,m.jsx)(S.Z,(0,i.Z)((0,i.Z)({id:"button-tooltip"},e),{},{children:"Clear Chat History"}))},children:(0,m.jsx)(p.Z,{className:"btn btn-secondary clear-history",isLoading:$,title:"Clear Chat History",onClick:ne,children:(0,m.jsx)(r.G,{icon:o.Vui})})})]})]}))}var P=s(7689),q=s(1087),U=s(5480),z=s(6334),F=s(9396),G=function(e){var n=e.files,s=e.setProgress,t=e.setIsSuccessUpload,o=e.resetDropzone,r=(e.name,e.createChatRoom),a=e.setProcessing,c=e.subscription,l=e.isDemo,u=e.demoSubscription,d=e.setDemoSubscription,m=e.queryClient;if(l&&u.pdfs<=0)return o(),b.Am.warning("The demo quota is exceeded, please wait 12 hours \ud83d\ude4f");if(!l){if(1!==(null===c||void 0===c?void 0:c.status))return o(),b.Am.warning("You need a valid subscription to continue.");if((null===c||void 0===c?void 0:c.pdfs)<=0)return o(),b.Am.warning("You have reached the maximum number of document uploads.")}(0,F.cT)("user/chat",n[0],{onUploadProgress:function(e){var n=e.loaded/e.total*100;s(n),n>=100&&a(!0)}}).then((function(e){var n;if(!e.data||null!==(n=e.data)&&void 0!==n&&n.errors){var s;b.Am.error(null===(s=e.data)||void 0===s?void 0:s.message),o()}else{var a=e.data.chat_room;r(a.uuid,a.title),t(!0),setTimeout((function(){o()}),5e3),l&&d((function(e){return(0,i.Z)((0,i.Z)({},e),{},{pdfs:e.pdfs-1})})),m.invalidateQueries("user.subscription")}})).catch((function(e){var n,s;422===e.response.status||400==e.response.status?b.Am.warning(null===(n=e.response)||void 0===n||null===(s=n.data)||void 0===s?void 0:s.message):b.Am.error(e.message);o()})).finally((function(){a(!1)}))},Q=function(e){b.Am.error("Invalid document!")};function _(){var e=(0,u.FO)().isDemo,n=(0,u.v$)("demo_sub",{pdfs:2,questions:10,created_at:(new Date).getTime()}),s=(0,t.Z)(n,2),i=s[0],f=s[1],p=i(),v=(0,u.Wn)().isExtendedLicense,x=(0,l.useState)(!1),j=(0,t.Z)(x,2),N=j[0],Z=j[1],k=(0,l.useState)(!1),A=(0,t.Z)(k,2),S=A[0],F=(A[1],(0,u.OR)("resize",window.innerWidth,(function(){return window.innerWidth}))),_=(0,t.Z)(F,2),O=_[0],T=(_[1],(0,U.A)().user),E=(0,g.SI)(),M=E.isLoading,L=E.subscription,I=(0,y.useQueryClient)(),Y=(0,P.s0)(),H=(0,P.UO)().uuid,R=(0,l.useState)(H),$=(0,t.Z)(R,2),B=$[0],W=$[1],J=(0,g.z$)(),V=J.isLoading,X=J.isError,K=J.error,ee=J.userChatRoomList,ne=(0,l.useState)(!1),se=(0,t.Z)(ne,2),te=se[0],ie=se[1],oe=(0,l.useCallback)((function(e){W(e),Y("/playground/".concat(e))}),[H]),re=(0,l.useCallback)((function(e,n){I.invalidateQueries("user.chat.list"),W(e),Y("/playground/".concat(e))}),[H]),ae=(0,l.useCallback)((function(e,n){(0,w.U1)(e).then((function(e){204===e.status?(I.invalidateQueries("user.chat.list"),b.Am.success("Deleted successfully.")):b.Am.warning("Something went wrong!")})).catch((function(e){b.Am.error(e)})).finally((function(){n()}))}),[H]);return(0,l.useEffect)((function(){var e,n;H&&B||void 0===ee||!Object.keys(ee).length?void 0===ee||Object.keys(ee).length||(W(""),Y("/playground")):(Y("/playground/".concat(null===(e=ee[0])||void 0===e?void 0:e.uuid)),W(null===(n=ee[0])||void 0===n?void 0:n.uuid))}),[H,ee]),(0,l.useEffect)((function(){(new Date).getTime()-p.created_at>432e5&&f({pdfs:2,questions:10,created_at:(new Date).getTime()})}),[]),X&&b.Am.error(K),!Object.keys(T).length||V||M?(0,m.jsx)(z.Z,{}):(0,m.jsx)(m.Fragment,{children:(0,m.jsxs)("main",{className:"playground",children:[(0,m.jsx)(c.YE,{toggled:N,collapsed:S,breakPoint:"md",onBackdropClick:function(){return Z(!N)},backgroundColor:"",className:"",children:(0,m.jsxs)("div",{className:"playground-sidebar",children:[(L||p)&&(0,m.jsx)(a.Z,{onUpload:G,onError:Q,name:"pdf-file",extraOnUploadProps:{createChatRoom:re,setProcessing:ie,subscription:L,isDemo:e,demoSubscription:p,setDemoSubscription:f,queryClient:I},dropzoneOptions:{accept:{"application/pdf":[".pdf"]},maxSize:52428800},children:te?(0,m.jsx)("div",{className:"text-center",children:(0,m.jsxs)("b",{children:[(0,m.jsx)(C,{size:"sm"})," Processing..."]})}):S?(0,m.jsx)(r.G,{icon:o.r8p}):(0,m.jsxs)("div",{className:"text-center",children:[(0,m.jsxs)("b",{children:[(0,m.jsx)(r.G,{icon:o.r8p})," New Chat"]}),(0,m.jsx)("p",{children:"Drag & Drop your PDF"})]})}),(0,m.jsx)("div",{className:"chat-labels-list my-3",children:null===ee||void 0===ee?void 0:ee.map((function(e,n){return(0,m.jsx)(h,{title:e.title,onClick:function(){return oe(e.uuid)},onDelete:function(n){return ae(e.uuid,n)},active:e.uuid===B},n)}))}),(0,m.jsxs)("div",{className:"sidebar-bottom-section",children:[e&&(0,m.jsxs)(m.Fragment,{children:[((null===L||void 0===L?void 0:L.questions)<=20||(null===L||void 0===L?void 0:L.pdfs)<=10)&&(0,m.jsxs)(q.rU,{to:"/account/settings/subscription",className:"btn btn-warning btn-lg btn-block",children:[(0,m.jsx)(r.G,{icon:o.fGT})," Upgrade"]}),(0,m.jsxs)("div",{className:"quota",children:[(0,m.jsx)("small",{children:"- Quota limited for demo only."}),(0,m.jsx)("br",{}),(0,m.jsx)("small",{children:"- Quota reset every 12 hours."}),(0,m.jsx)("h3",{className:"h6",children:"Quota:"}),(0,m.jsxs)("span",{children:[null===p||void 0===p?void 0:p.pdfs," PDFs"]}),(0,m.jsx)("br",{}),(0,m.jsxs)("span",{children:["Max PDF size: ",null===L||void 0===L?void 0:L.pdf_size,"MB/pdf"]}),(0,m.jsx)("br",{}),(0,m.jsxs)("span",{children:[null===p||void 0===p?void 0:p.questions," PDF Questions"]}),(0,m.jsx)("br",{})]})]}),L&&v&&!e&&(0,m.jsxs)(m.Fragment,{children:[((null===L||void 0===L?void 0:L.questions)<=20||(null===L||void 0===L?void 0:L.pdfs)<=10)&&(0,m.jsxs)(q.rU,{to:"/account/settings/subscription",className:"btn btn-warning btn-lg btn-block",children:[(0,m.jsx)(r.G,{icon:o.fGT})," Upgrade"]}),(0,m.jsxs)("div",{className:"quota",children:[(0,m.jsx)("h3",{className:"h6",children:"Quota:"}),(0,m.jsxs)("span",{children:[null===L||void 0===L?void 0:L.pdfs," PDFs"]}),(0,m.jsx)("br",{}),(0,m.jsxs)("span",{children:["Max PDF size: ",null===L||void 0===L?void 0:L.pdf_size,"MB/pdf"]}),(0,m.jsx)("br",{}),(0,m.jsxs)("span",{children:[null===L||void 0===L?void 0:L.questions," PDF Questions"]}),(0,m.jsx)("br",{})]})]}),T&&(0,m.jsxs)("div",{className:"profile",onClick:function(){return Y("/account/settings")},children:[(0,m.jsx)(d.Z,{username:T.username,size:45}),(0,m.jsxs)("div",{children:[(0,m.jsx)("b",{children:T.username}),(0,m.jsx)("br",{}),(0,m.jsxs)("span",{children:["(",T.email,")"]})]})]}),(0,m.jsxs)("footer",{children:[(0,m.jsx)(q.rU,{to:"/",children:"Home"}),v&&(0,m.jsx)(q.rU,{to:"/pricing",children:"Pricing"}),(0,m.jsx)(q.rU,{to:"/contact",children:"Contact us"})]})]})]})}),(0,m.jsxs)("section",{className:"playground-chat-section",children:[O<=768&&(0,m.jsx)("button",{type:"button",onClick:function(){return Z((function(e){return!e}))},className:"btn btn-light toggle-sidebar-button text-primary",children:(0,m.jsx)(r.G,{icon:o.Ljc})}),(0,m.jsx)("section",{className:"d-flex flex-column",children:v?L&&1==(null===L||void 0===L?void 0:L.status)||e?(null===L||void 0===L?void 0:L.questions)<=0?(0,m.jsxs)("div",{className:"d-flex flex-column justify-content-start p-5",children:["Your subscription has reached its maximum usage.",(0,m.jsx)(q.rU,{to:"/pricing",className:"btn btn-warning my-3",children:"Upgrade Now?"})]}):B&&(0,m.jsx)(D,{uuid:B},H):(0,m.jsxs)("div",{className:"d-flex flex-column justify-content-start p-5",children:["You need to have a subscription in order to be able to use the Playground section.",(0,m.jsx)(q.rU,{to:"/pricing",className:"btn btn-warning my-3",children:"Get a subscription now?"})]}):B&&(0,m.jsx)(D,{uuid:B},H)})]})]})})}}}]);
//# sourceMappingURL=38.a84af955.chunk.js.map