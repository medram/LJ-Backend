"use strict";(self.webpackChunkAskPDF_frontend=self.webpackChunkAskPDF_frontend||[]).push([[856],{8856:function(e,n,s){s.r(n),s.d(n,{default:function(){return R}});var i=s(7762),t=s(9439),o=s(1413),r=s(1632),a=s(9806),c=s(3394),l=s(1975),u=s(2791),d=s(7224),m=s(9626),h=s(6920),p=s(211),f=s(7850),v=s(184);function x(e){var n=e.title,s=e.onClick,i=e.onDelete,o=e.active,c=void 0!==o&&o,l=(0,u.useState)(!1),d=(0,t.Z)(l,2),m=d[0],x=d[1];return(0,v.jsxs)("div",{role:"button",className:["chat-label",c&&"active"].join(" "),onClick:s,children:[(0,v.jsx)(h.Z,{icon:p.Z,stroke:1.25})," ",n,(0,v.jsx)("span",{className:"delete",onClick:function(){x(!0),"function"===typeof i&&i((function(){x(!1)}))},children:m?(0,v.jsx)(a.G,{icon:r.IJ7,spin:!0}):(0,v.jsx)(h.Z,{icon:f.Z,stroke:1.25})})]})}var j=s(3433),g=s(3257);function b(e){var n=e.content.split("\n").map((function(e,n){return(0,v.jsx)("p",{children:e},n)}));return(0,v.jsx)("div",{className:"message ai-message",children:n})}function y(e){var n=e.content;return(0,v.jsx)("div",{className:"message user-message",children:n})}var Z=s(1233),N=s(138),w=s(9085),k=s(1933),C=s(9128),D=s(2670);function A(e){var n=e.content;return(0,v.jsxs)("div",{className:"message ai-message",children:[(0,v.jsx)(D.Z,{size:"sm"})," ",n||" Thinking..."]})}var S=s(476),P=s(2576),z=s(3948),q=s(1811);function F(e){var n=e.uuid,s=(0,d.FO)().isDemo,i=(0,d.v$)("demo_sub"),r=(0,t.Z)(i,2),a=r[0],c=r[1],l=a(),m=(0,k.useQueryClient)(),p=(0,N.ZP)(n),x=p.isLoading,D=p.isError,F=p.error,U=p.chat,Q=(0,u.useState)([]),O=(0,t.Z)(Q,2),_=O[0],E=O[1],T=(0,u.useState)(""),G=(0,t.Z)(T,2),L=G[0],M=G[1],R=(0,u.useState)(!1),Y=(0,t.Z)(R,2),I=Y[0],B=Y[1],W=(0,u.useState)(!1),$=(0,t.Z)(W,2),H=$[0],J=$[1],K=(0,d.bg)(),V=(0,t.Z)(K,2),X=V[0],ee=V[1];(0,u.useEffect)((function(){if(null!==U&&void 0!==U&&U.chat_history)try{var e=[];JSON.parse(null===U||void 0===U?void 0:U.chat_history).map((function(n,s){"ai"===n.type?e[s]=(0,v.jsx)(b,{content:n.content},s):e[s]=(0,v.jsx)(y,{content:n.content},s)})),E(e)}catch(F){console.log("error parsing chat history")}else E([]);ee()}),[x,U]),(0,u.useEffect)((function(){ee()}),[]);var ne=(0,u.useCallback)((function(e){return e.preventDefault(),L.trim()?s&&(null===l||void 0===l?void 0:l.questions)<=0?w.Am.warning("The demo quota is exceeded, please wait 12 hours \ud83d\ude4f"):(B(!0),E((function(e){return[].concat((0,j.Z)(e),[(0,v.jsx)(y,{content:L},Math.random()),(0,v.jsx)(A,{},Math.random())])})),M(""),ee(),void(0,C.u3)(n,L).then((function(e){if(null!==e&&void 0!==e&&e.errors)w.Am.error(e.message),E((function(e){return e.slice(0,-1)}));else{var n,i,t=null===e||void 0===e||null===(n=e.response)||void 0===n||null===(i=n.output)||void 0===i?void 0:i.trim();t||w.Am.error("OpenAI servers are overloaded, please try again or later"),E((function(e){return[].concat((0,j.Z)(e.slice(0,-1)),[(0,v.jsx)(b,{content:t},Math.random())])})),m.invalidateQueries("user.subscription"),s&&c((function(e){return(0,o.Z)((0,o.Z)({},e),{},{questions:e.questions-1})}))}})).catch((function(e){var n,s,i,t;null!==(n=e.response)&&void 0!==n&&null!==(s=n.data)&&void 0!==s&&s.message?w.Am.warning(null===(i=e.response)||void 0===i||null===(t=i.data)||void 0===t?void 0:t.message):w.Am.error(e.message);E((function(e){return e.slice(0,-1)}))})).finally((function(){B(!1),m.invalidateQueries("user.chat.".concat(n)),ee()}))):w.Am.warning("Please ask something.")}),[n,L]),se=(0,u.useCallback)((function(e){(0,C.tY)(n).then((function(e){console.log("prompt stopped")})).catch((function(e){var n,s;422===e.response.status||400===e.response.status?w.Am.warning(null===(n=e.response)||void 0===n||null===(s=n.data)||void 0===s?void 0:s.message):w.Am.error(e.message)})).finally((function(){})),B(!1),E((function(e){return e.slice(0,-1)}))}),[n]),ie=(0,u.useCallback)((function(){J(!0),(0,C.zR)(n).then((function(e){204===e.status?(w.Am.success("Cleared successfully."),m.invalidateQueries("user.chat.".concat(n)),E([])):w.Am.warning("Something went wrong!")})).catch((function(e){w.Am.error(e)})).finally((function(){J(!1)}))}),[n]);return x?(0,v.jsx)(Z.Z,{center:!0}):(D&&w.Am.error(F),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"chats flex-grow-1 d-flex align-items-end",children:(0,v.jsx)("div",{className:"container px-4",children:_.map((function(e,n){return e}))})}),(0,v.jsxs)("div",{className:"container prompt-input d-flex gap-2 pt-5 pb-4 px-4",ref:X,children:[(0,v.jsx)("form",{onSubmit:ne,className:"flex-grow-1",children:(0,v.jsx)("input",{type:"text",value:L,onChange:function(e){return M(e.target.value)},className:"form-control form-control-lg",placeholder:"Ask your document a question?"})}),(0,v.jsx)(S.Z,{placement:"top",delay:{show:250,hide:400},overlay:function(e){return(0,v.jsx)(P.Z,(0,o.Z)((0,o.Z)({id:"button-tooltip"},e),{},{children:I?"Stop":"Send"}))},children:(0,v.jsx)(g.Z,{disabled:!L&&!I,className:["btn btn-sm send",I?"btn-danger":"btn-primary"].join(" "),title:I?"Stop":"Send",onClick:function(e){if(I)return se(e);ne(e)},children:I?(0,v.jsx)(h.Z,{icon:z.Z}):(0,v.jsx)(h.Z,{icon:q.Z})})}),(0,v.jsx)(S.Z,{placement:"top",delay:{show:250,hide:400},overlay:function(e){return(0,v.jsx)(P.Z,(0,o.Z)((0,o.Z)({id:"button-tooltip"},e),{},{children:"Clear Chat History"}))},children:(0,v.jsx)(g.Z,{className:"btn btn-outline-secondary clear-history",isLoading:H,title:"Clear Chat History",onClick:ie,children:(0,v.jsx)(h.Z,{icon:f.Z})})})]}),(0,v.jsx)("div",{className:"container px-4 mb-2",children:(0,v.jsxs)("small",{children:[(0,v.jsx)("b",{children:"Note:"})," if the chat bot didn't know how to access to document or where to look up, just tell him \"",(0,v.jsx)("b",{children:(0,v.jsx)("i",{children:"from document?"})}),'".']})})]}))}var U=s(7689),Q=s(1087),O=s(5480),_=s(6334),E=s(9396),T=s(8241),G=s(319),L=function(e){var n=e.files,s=e.setProgress,i=e.setIsSuccessUpload,t=e.resetDropzone,r=(e.name,e.createChatRoom),a=e.setProcessing,c=e.subscription,l=e.isDemo,u=e.demoSubscription,d=e.setDemoSubscription,m=e.queryClient;if(l&&u.pdfs<=0)return t(),w.Am.warning("The demo quota is exceeded, please wait 12 hours \ud83d\ude4f");if(!l){if(1!==(null===c||void 0===c?void 0:c.status))return t(),w.Am.warning("You need a valid subscription to continue.");if((null===c||void 0===c?void 0:c.pdfs)<=0)return t(),w.Am.warning("You have reached the maximum number of document uploads.")}(0,E.cT)("user/chat",n[0],{onUploadProgress:function(e){var n=e.loaded/e.total*100;s(n),n>=100&&a(!0)}}).then((function(e){var n;if(!e.data||null!==(n=e.data)&&void 0!==n&&n.errors){var s;w.Am.error(null===(s=e.data)||void 0===s?void 0:s.message),t()}else{var a=e.data.chat_room;r(a.uuid,a.title),i(!0),setTimeout((function(){t()}),5e3),l&&d((function(e){return(0,o.Z)((0,o.Z)({},e),{},{pdfs:e.pdfs-1})})),m.invalidateQueries("user.subscription")}})).catch((function(e){var n,s;422===e.response.status||400==e.response.status?w.Am.warning(null===(n=e.response)||void 0===n||null===(s=n.data)||void 0===s?void 0:s.message):w.Am.error(e.message);t()})).finally((function(){a(!1)}))},M=function(e){w.Am.error("Invalid document!")};function R(){var e=(0,d.FO)().isDemo,n=(0,d.v$)("demo_sub",{pdfs:2,questions:10,created_at:(new Date).getTime()}),s=(0,t.Z)(n,2),o=s[0],p=s[1],f=e?o():null,j=(0,d.Wn)().isExtendedLicense,g=(0,u.useState)(!1),b=(0,t.Z)(g,2),y=b[0],Z=b[1],A=(0,u.useState)(!1),S=(0,t.Z)(A,2),P=S[0],z=(S[1],(0,d.OR)("resize",window.innerWidth,(function(){return window.innerWidth}))),q=(0,t.Z)(z,2),E=q[0],R=(q[1],(0,O.A)().user),Y=(0,N.SI)(),I=Y.isLoading,B=Y.subscription,W=(0,k.useQueryClient)(),$=(0,U.s0)(),H=(0,U.UO)().uuid,J=(0,u.useState)(H),K=(0,t.Z)(J,2),V=K[0],X=K[1],ee=(0,N.z$)(),ne=ee.isLoading,se=ee.isError,ie=ee.error,te=ee.userChatRoomList,oe=(0,u.useState)(!1),re=(0,t.Z)(oe,2),ae=re[0],ce=re[1];(0,u.useEffect)((function(){H!==V&&$("/playground/".concat(V))}),[V]);var le=(0,u.useCallback)((function(e){X(e),$("/playground/".concat(e))}),[H]),ue=(0,u.useCallback)((function(e,n){W.invalidateQueries("user.chat.list"),X(e),$("/playground/".concat(e))}),[H]),de=(0,u.useCallback)((function(e,n){var s="";if(te){var t,o=(0,i.Z)(te);try{for(o.s();!(t=o.n()).done;){var r=t.value;if((null===r||void 0===r?void 0:r.uuid)!==e){s=null===r||void 0===r?void 0:r.uuid;break}}}catch(a){o.e(a)}finally{o.f()}}(0,C.U1)(e).then((function(e){204===e.status?(w.Am.success("Deleted successfully."),W.invalidateQueries("user.chat.list").then((function(){s&&X(s)}))):w.Am.warning("Something went wrong!")})).catch((function(e){w.Am.error(e)})).finally((function(){n()}))}),[H,te]);return(0,u.useEffect)((function(){var e,n;H&&V||void 0===te||!Object.keys(te).length?void 0===te||Object.keys(te).length||(X(""),$("/playground")):($("/playground/".concat(null===(e=te[0])||void 0===e?void 0:e.uuid)),X(null===(n=te[0])||void 0===n?void 0:n.uuid))}),[H,te]),(0,u.useEffect)((function(){(new Date).getTime()-(null===f||void 0===f?void 0:f.created_at)>432e5&&p({pdfs:2,questions:10,created_at:(new Date).getTime()})}),[]),se&&w.Am.error(ie),!Object.keys(R).length||ne||I?(0,v.jsx)(_.Z,{}):(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)("main",{className:"playground",children:[(0,v.jsx)(l.YE,{width:"290px",toggled:y,collapsed:P,breakPoint:"md",onBackdropClick:function(){return Z(!y)},backgroundColor:"",className:"",children:(0,v.jsxs)("div",{className:"playground-sidebar",children:[!(null===te||void 0===te||!te.length)&&(B||f)&&(0,v.jsx)(c.Z,{onUpload:L,onError:M,name:"pdf-file",extraOnUploadProps:{createChatRoom:ue,setProcessing:ce,subscription:B,isDemo:e,demoSubscription:f,setDemoSubscription:p,queryClient:W},dropzoneOptions:{accept:{"application/pdf":[".pdf"]},maxSize:52428800},children:ae?(0,v.jsx)("div",{className:"text-center",children:(0,v.jsxs)("b",{children:[(0,v.jsx)(D.Z,{size:"sm"})," Processing..."]})}):P?(0,v.jsx)(a.G,{icon:r.r8p}):(0,v.jsxs)("div",{className:"text-center",children:[(0,v.jsxs)("b",{children:[(0,v.jsx)(a.G,{icon:r.r8p})," New Chat"]}),(0,v.jsx)("p",{children:"Drag & Drop your PDF"})]})}),(0,v.jsx)("div",{className:"chat-labels-list my-3",children:null===te||void 0===te?void 0:te.map((function(e,n){return(0,v.jsx)(x,{title:e.title,onClick:function(){return le(e.uuid)},onDelete:function(n){return de(e.uuid,n)},active:e.uuid===V},n)}))}),(0,v.jsxs)("div",{className:"sidebar-bottom-section",children:[e&&(0,v.jsxs)(v.Fragment,{children:[((null===B||void 0===B?void 0:B.questions)<=20||(null===B||void 0===B?void 0:B.pdfs)<=10)&&(0,v.jsxs)(Q.rU,{to:"/pricing",className:"btn btn-warning btn-lg btn-block",children:[(0,v.jsx)(h.Z,{icon:T.Z,stroke:1.5,size:30})," Upgrade"]}),(0,v.jsxs)("div",{className:"quota",children:[(0,v.jsx)("small",{children:"- Quota limited for demo only."}),(0,v.jsx)("br",{}),(0,v.jsx)("small",{children:"- Quota reset every 12 hours."}),(0,v.jsx)("h3",{className:"h6",children:"Quota:"}),(0,v.jsxs)("span",{children:[null===f||void 0===f?void 0:f.pdfs," PDFs"]}),(0,v.jsx)("br",{}),(0,v.jsxs)("span",{children:["Max PDF size: ",null===B||void 0===B?void 0:B.pdf_size,"MB/pdf"]}),(0,v.jsx)("br",{}),(0,v.jsxs)("span",{children:[null===f||void 0===f?void 0:f.questions," PDF Questions"]}),(0,v.jsx)("br",{})]})]}),B&&j&&!e&&(0,v.jsxs)(v.Fragment,{children:[((null===B||void 0===B?void 0:B.questions)<=20||(null===B||void 0===B?void 0:B.pdfs)<=10)&&(0,v.jsxs)(Q.rU,{to:"/pricing",className:"btn btn-warning btn-lg btn-block",children:[(0,v.jsx)(h.Z,{icon:T.Z,stroke:1.5,size:30})," Upgrade"]}),(0,v.jsxs)("div",{className:"quota",children:[(0,v.jsx)("h3",{className:"h6",children:"Available Subscription Quota:"}),(0,v.jsxs)("span",{children:[null===B||void 0===B?void 0:B.pdfs," PDFs left."]}),(0,v.jsx)("br",{}),(0,v.jsxs)("span",{children:["Max PDF size: ",null===B||void 0===B?void 0:B.pdf_size,"MB/pdf."]}),(0,v.jsx)("br",{}),(0,v.jsxs)("span",{children:[null===B||void 0===B?void 0:B.questions," PDF Questions left."]}),(0,v.jsx)("br",{})]})]}),R&&(0,v.jsxs)("div",{className:"profile",onClick:function(){return $("/account/settings")},children:[(0,v.jsx)(m.Z,{username:R.username,size:45}),(0,v.jsxs)("div",{children:[(0,v.jsx)("b",{children:R.username}),(0,v.jsx)("br",{}),(0,v.jsxs)("span",{children:["(",R.email,")"]})]}),(0,v.jsx)("div",{className:"",children:(0,v.jsx)(a.G,{icon:r._tD})})]})]})]})}),(0,v.jsxs)("section",{className:"playground-chat-section",children:[E<=768&&(0,v.jsx)("button",{type:"button",onClick:function(){return Z((function(e){return!e}))},className:"btn btn-light toggle-sidebar-button text-primary",children:(0,v.jsx)(a.G,{icon:r.Ljc})}),(0,v.jsxs)("section",{className:"d-flex flex-column",children:[j?B&&1==(null===B||void 0===B?void 0:B.status)||e?(null===B||void 0===B?void 0:B.questions)<=0?(0,v.jsxs)("div",{className:"d-flex flex-column justify-content-start p-5",children:["Your subscription has reached its maximum usage.",(0,v.jsx)(Q.rU,{to:"/pricing",className:"btn btn-warning my-3",children:"Upgrade Now?"})]}):V&&(0,v.jsx)(F,{uuid:V},V):(0,v.jsxs)("div",{className:"d-flex flex-column justify-content-start p-5 mt-3",children:["You need to have a subscription in order to be able to use the Playground section.",(0,v.jsx)(Q.rU,{to:"/pricing",className:"btn btn-warning my-3",children:"Get a subscription now?"})]}):V&&(0,v.jsx)(F,{uuid:V},V),!V&&(0,v.jsx)("div",{className:"d-flex justify-content-center align-items-center h-100",children:(0,v.jsx)("div",{className:"w-50",children:(B||f)&&(0,v.jsxs)("div",{className:"text-center",children:[(0,v.jsx)("h3",{children:"Upload your PDF to chat with."}),(0,v.jsx)(c.Z,{onUpload:L,onError:M,name:"pdf-file",extraOnUploadProps:{createChatRoom:ue,setProcessing:ce,subscription:B,isDemo:e,demoSubscription:f,setDemoSubscription:p,queryClient:W},dropzoneOptions:{accept:{"application/pdf":[".pdf"]},maxSize:52428800},children:ae?(0,v.jsx)("div",{className:"text-center",children:(0,v.jsxs)("b",{children:[(0,v.jsx)(D.Z,{size:"sm"})," Processing..."]})}):P?(0,v.jsx)(a.G,{icon:r.r8p}):(0,v.jsxs)("div",{className:"text-center",children:[(0,v.jsxs)("b",{children:[(0,v.jsx)(h.Z,{icon:G.Z,size:40}),(0,v.jsx)("br",{})," Upload you PDF"]}),(0,v.jsx)("p",{children:"(Drag & Drop)"})]})})]})})})]})]})]})})}}}]);
//# sourceMappingURL=856.37f3131a.chunk.js.map